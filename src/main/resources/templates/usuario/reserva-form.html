<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Reserva de Hotel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<div class="container py-5">
    <h1 class="text-center mb-4">Reservar en <span th:text="${hotel.nombre}">Nombre Hotel</span></h1>

    <div class="mb-4">
        <h5>Dirección:</h5>
        <p th:text="${hotel.direccion}">Dirección del hotel</p>
    </div>

    <form method="post"
          th:action="@{'/reserva/hoteles/' + ${hotel.id} + '/reservar'}"
          th:object="${reserva}">

        <!-- Enviar el hotel.id oculto -->
        <input type="hidden" th:field="*{hotel.id}" />

        <!-- Sección Cliente -->
        <div class="card mb-4">
            <div class="card-header">Datos del Cliente</div>
            <div class="card-body row g-3">
                <div class="col-md-6">
                    <label class="form-label">Nombre completo</label>
                    <input type="text" class="form-control" th:field="*{cliente.nombre}" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">DNI</label>
                    <input type="text" class="form-control" th:field="*{cliente.dni}" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Correo electrónico</label>
                    <input type="email" class="form-control" th:field="*{cliente.email}" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Teléfono</label>
                    <input type="tel" class="form-control" th:field="*{cliente.telefono}" required />
                </div>
            </div>
        </div>

        <!-- Fechas -->
        <div class="card mb-4">
            <div class="card-header">Fechas de la Reserva</div>
            <div class="card-body row g-3">
                <div class="col-md-6">
                    <label class="form-label">Fecha de Entrada</label>
                    <input type="date" class="form-control" th:field="*{fechaInicio}" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Fecha de Salida</label>
                    <input type="date" class="form-control" th:field="*{fechaFin}" required />
                </div>
            </div>
        </div>

        <!-- Select base oculto con opciones Thymeleaf -->
        <select id="selectBase" class="d-none">
		    <option value="">-- Selecciona --</option>
		    <option th:each="habitacion : ${habitaciones}"
		            th:value="${habitacion.id}"
		            th:text="${habitacion.tipoHabitacion.nombre} + ' - S/ ' + ${habitacion.precio}">
		    </option>
		</select>


        <!-- Selección de habitaciones -->
        <div class="card mb-4">
            <div class="card-header">Seleccionar habitaciones</div>
            <div class="card-body">
                <div id="habitacionesContainer">
                    <!-- Aquí se añadirán selects dinámicamente -->
                </div>
                <button type="button" class="btn btn-outline-primary mt-3" onclick="añadirHabitacion()">Añadir habitación</button>
                <div class="mt-3">
                    <strong>Total: <span id="precioTotal">S/ 0.00</span></strong>
                </div>
            </div>
        </div>

        <!-- Botones -->
        <div class="text-center">
            <button type="submit" class="btn btn-success">Reservar</button>
            <button type="button" class="btn btn-secondary" onclick="verificarEstado()">Verificar Estado de Habitaciones</button>
        </div>
    </form>
</div>

<script>
    // Estos precios y nombres idealmente deberían venir desde el backend, 
    // pero dejo ejemplo estático para que funcione
    const precios = {
        "1": 150.00,
        "2": 180.00,
        "4": 350.00
    };

    const nombres = {
        "1": "Habitación Simple",
        "2": "Habitación Doble",
        "4": "Habitación Suite"
    };

    let contador = 0;

    function añadirHabitacion() {
        contador++;
        const contenedor = document.getElementById('habitacionesContainer');

        // Crear un div contenedor
        const div = document.createElement('div');
        div.className = 'mb-3';

        // Clonar el select base y configurar atributos
        const selectBase = document.getElementById('selectBase');
        const selectClonado = selectBase.cloneNode(true);
        selectClonado.id = ''; // quitar id para evitar duplicados
        selectClonado.classList.remove('d-none');
        selectClonado.classList.add('form-select', 'habitacion-select');
        selectClonado.name = "habitacionesSeleccionadas";
        selectClonado.setAttribute('onchange', 'actualizarPrecioTotal()');

        // Añadir etiqueta, select y div para detalle
        div.innerHTML = `<label class="form-label">Habitación ${contador}</label>`;
        div.appendChild(selectClonado);

        const detalleDiv = document.createElement('div');
        detalleDiv.className = 'mt-1 text-muted detalle-habitacion';
        div.appendChild(detalleDiv);

        contenedor.appendChild(div);
    }

    function actualizarPrecioTotal() {
        let total = 0;
        const selects = document.querySelectorAll('.habitacion-select');
        selects.forEach(select => {
            const valor = select.value;
            const detalle = select.nextElementSibling;
            if (precios[valor]) {
                total += precios[valor];
                detalle.textContent = `${nombres[valor]} - S/ ${precios[valor].toFixed(2)}`;
            } else {
                detalle.textContent = '';
            }
        });
        document.getElementById('precioTotal').textContent = `S/ ${total.toFixed(2)}`;
    }

    function verificarEstado() {
        alert("Funcionalidad de verificación de estado en desarrollo...");
    }

    // Añadir un select al cargar la página
    window.onload = añadirHabitacion;
</script>

</body>
</html>


